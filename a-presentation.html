<dom-module id="a-presentation">
  <style>
    :host {
      display: block;
      box-sizing: border-box;
      height: 100vh;
      width: 100%;
    }

    :host > ::content > :not([showing]) {
      display: none !important;
    }
  </style>

  <template>
    <content select="a-slide"></content>
  </template>

  <script>
    Polymer({
      is: 'a-presentation',

      hostAttributes: {
        'tabindex': 0
      },

      attached: function() {
        this.focus();
        this._currentSlide = 0;

        // Check if there's an initial loaded slide, or the default one.
        this._loadHashSlide();
        window.addEventListener('hashchange', this._loadHashSlide.bind(this));

        this.addEventListener('keydown', function(event) {
          if (event.keyCode == '38') {  // up arrow
            this.previous();
          } else if (event.keyCode == '40') {  // down arrow
            this.next();
          } else if (event.keyCode == '37') {  // left arrow
            this.previous();
          } else if (event.keyCode == '39') {  // right arrow
            this.next();
          } else if (event.keyCode == '32' || event.charChode == '32') {  // space
            this.next();
          } else if (event.keyCode == '13') {  // enter
            this.next();
          }
        }, true);

        this.addEventListener('click', function(event) {
          var clickX = event.clientX;
          if (clickX > (screen.width / 2))
            this.next();
          else {
            this.previous();
          }
        });
      },

      next: function() {
        var children = this.children;

        if (this._currentSlide === (children.length - 1)) {
          newSlide = 0;
        } else {
          newSlide = this._currentSlide + 1;
        }
        this._transition(children, newSlide);
      },

      previous: function() {
        var children = this.children;

        var newSlide;
        if (this._currentSlide === 0) {
          newSlide = children.length - 1;
        } else {
          newSlide = this._currentSlide - 1;
        }
        this._transition(children, newSlide);
      },

      _transition: function(children, newSlide) {
        children[this._currentSlide].removeAttribute('showing');
        children[newSlide].setAttribute('showing', true);
        this._currentSlide = newSlide;

        // Make sure the hash is in sync.
        window.location.hash = this._currentSlide;
      },

      _loadHashSlide: function() {
        var slide = parseInt(window.location.hash.replace('#', ''));

        // Sweet, sweet edge checking.
        var children = this.children;
        if (slide === '' || slide < 0 || slide > children.length - 1)
          slide = 0;

        // If we've actually changed the page, change it.
        if (this._currentSlide !== slide)
          this._transition(children, slide);
      }
    });
  </script>
</dom-module>
